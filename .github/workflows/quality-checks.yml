name: Quality Checks

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

permissions:
  contents: read

jobs:
  markdown-lint:
    name: Markdown Linting
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Lint Markdown files
        uses: DavidAnson/markdownlint-cli2-action@v18
        with:
          globs: '**/*.md'
          config: '.markdownlint.json'
        continue-on-error: true

  link-checker:
    name: Check Links
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check links in markdown files
        uses: gaurav-nelson/github-action-markdown-link-check@v1
        with:
          use-quiet-mode: 'yes'
          config-file: '.markdown-link-check.json'
        continue-on-error: true

  shell-check:
    name: Shell Script Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Run ShellCheck
        uses: ludeeus/action-shellcheck@master
        with:
          scandir: '.'
          severity: warning
        continue-on-error: true

  yaml-lint:
    name: YAML Validation
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Lint YAML files
        uses: ibiqlik/action-yamllint@v3
        with:
          file_or_dir: '.'
          config_file: '.yamllint.yml'
          strict: false
        continue-on-error: true

  file-structure:
    name: Validate Repository Structure
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check required files
        run: |
          echo "Checking repository structure..."
          
          # Check for LICENSE
          if [ ! -f "LICENSE" ]; then
            echo "❌ LICENSE file missing"
            exit 1
          fi
          echo "✅ LICENSE found"
          
          # Check for main README
          if [ ! -f "README.md" ]; then
            echo "❌ README.md missing"
            exit 1
          fi
          echo "✅ README.md found"
          
          # Check for .gitignore
          if [ ! -f ".gitignore" ]; then
            echo "❌ .gitignore missing"
            exit 1
          fi
          echo "✅ .gitignore found"
          
          # Check each lab/demo has README
          for dir in */; do
            if [[ "$dir" == .* ]] || [[ "$dir" == "node_modules/" ]]; then
              continue
            fi
            
            if [ ! -f "${dir}README.md" ]; then
              echo "⚠️  ${dir} missing README.md"
            else
              echo "✅ ${dir}README.md found"
            fi
          done
          
          echo "✅ Repository structure validation complete"

  readme-quality:
    name: README Quality Check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Check README content
        run: |
          echo "Checking README quality..."
          
          # Check main README has key sections
          if ! grep -q "## " README.md; then
            echo "⚠️  README.md should have sections (##)"
          fi
          
          # Check for badges
          if ! grep -q "!\[" README.md; then
            echo "⚠️  README.md should have badges"
          fi
          
          # Check for author info
          if ! grep -q -i "author\|created by" README.md; then
            echo "⚠️  README.md should have author information"
          fi
          
          # Check for license mention
          if ! grep -q -i "license" README.md; then
            echo "⚠️  README.md should mention license"
          fi
          
          echo "✅ README quality check complete"
